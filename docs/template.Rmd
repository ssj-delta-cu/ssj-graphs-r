---
title: "R Notebook for prelim results"
output:
  html_document:
    collapsed: yes
    df_print: paged
    smooth_scroll: yes
    theme: cerulean
    toc: yes
    toc_float: yes
  html_notebook:
    collapsed: yes
    smooth_scroll: yes
    theme: cerulean
    toc: yes
    toc_float: yes
---

```{r "setup", include=FALSE}
require("knitr")
opts_knit$set(root.dir = "..") # set working directory to be ssj-graph-r directory
```

This R notebook is for a template for each method. Each method's results should be copied to another notebook and run separately. 

```{r source, echo=FALSE, include=FALSE}
# load in library and data
source("scripts/helper_functions.R") # functions to help tidy the data
source("scripts/figures.R") # load all the ggplot2 figure functions

# data source 
data <- readRDS("wy_2015.rds") # geojson parsed and stored as a rds object (json2df.R)

crops_2_gen <- crop_list()
month_2_gen <- month_list()

```

# SIMS
```{r, echo=FALSE}
# methods_2_gen # list of method names in the dataframe
selected_model <- "sims" # 
print(paste("Model for this workbook:", selected_model))
print(paste("Last Updated: ", Sys.time()))
```

# Data

Preview of dataframe. Not all data is shown - query is filtered by selected model and the DSA region. In addtion, the following columns don't appear in the table: `level_2`, `median`, `p25`, `p75`, `p9`, `p91`, `model`, `source`, `include`, `num_days`.
```{r head, echo=FALSE}
subset_data <- data %>% filter(model == selected_model, region == "dsa")
select_cols <- subset(subset_data, select=c("wateryear", "month", "cropname", "count", "mean", "crop_acft"))
DT::datatable(select_cols, rownames=FALSE)

```

# Plots

## Pie Chart

### 2015 Water Year 
```{r plot_pie_15, fig.width=7, fig.height=4, echo=FALSE}

print(piechart_TAFxCrop_PERCENT_wy_by_topcrops(data, 2015, "dsa", selected_model))

```



### 2016 Water Year 
```{r plot_pie_16, fig.width=7, fig.height=4, echo=FALSE}

# print(piechart_TAFxCrop_PERCENT_wy_by_topcrops(data, 2016, "dsa", selected_model))

```

## Line Plots

### 2015 Water Year 
```{r plot_line_15, fig.width=7, fig.height=4, echo=FALSE}

for(i in 1:length(crops_2_gen)){
  id <- lookup_cropid(crops_2_gen[i])
  print(line_ETxMonths(subset_data,id, 2015, "dsa"))
}

```

### 2016 Water Year 
```{r plot_line_16, fig.width=7, fig.height=4, echo=FALSE}

for(i in 1:length(crops_2_gen)){
  id <- lookup_cropid(crops_2_gen[i])
  print(line_ETxMonths(subset_data,id, 2016, "dsa"))
}

```

## Boxplots
Boxplots show the 9th percentile (lower whisker), 25th percentile (lower box edge), median (horizontal line), 75th percentile (upper box edge) and 91th percentile (upper whisker). 

### 2015 Water Year
```{r plot_box_15, fig.width=7, fig.height=4, echo=FALSE}

for(i in 1:length(crops_2_gen)){
  id <- lookup_cropid(crops_2_gen[i])
  print(whisker_ETxMonths_per_crop_method(data, "dsa", 2015, selected_model, id))
}

```
### 2016 Water Year
```{r plot_box_16, fig.width=7, fig.height=4, echo=FALSE}

for(i in 1:length(crops_2_gen)){
  id <- lookup_cropid(crops_2_gen[i])
  print(whisker_ETxMonths_per_crop_method(data, "dsa", 2016, selected_model, id))
}

```
